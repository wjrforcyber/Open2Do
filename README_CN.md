# Open2Do

一个功能丰富的本地 Web 待办事项应用，具有 AI 驱动的任务执行和管理功能。

[English Documentation](README.md)

<div align="center">
  <img src="app/static/o2dologo.png" alt="Open2Do Logo" width="200" height="200"/>
</div>

> [!NOTE]
> 这个项目是基于我自己的需求，在 GLM-4.7 的帮助下构建的。如果你喜欢它，可以根据自己的喜好进行修改。

## 功能特性

### 核心功能
- **简洁现代的 UI**：基于 Bootstrap CSS 构建的响应式网页界面，采用深色主题
- **本地运行**：完全在 `localhost:8000` 上运行 - 无需云服务
- **实时仪表板**：统计仪表板每 10 秒自动刷新
- **JSON 存储**：简单的无数据库 JSON 文件存储

### 任务管理
- **完整的 CRUD 操作**：创建、读取、更新和删除任务
- **任务分类**：按类别组织任务（工作、个人、购物等）
- **优先级**：低、中、高优先级，带有视觉指示器
- **状态跟踪**：待办、进行中、已完成状态
- **截止日期支持**：设置和显示精确到时间的截止日期
- **创建日期跟踪**：自动跟踪每个任务的创建时间
- **独立工作区**：每个任务在 `data/task_folders/` 中都有自己的文件夹

### 高级功能
- **AI 驱动的执行**：使用 iFlow CLI 执行任务，具有 AI 权限检查
- **AI 自然语言自动填充**：解析自然语言输入以自动填充表单（新建任务、筛选任务、排序方式），并提供确认预览
- **Canvas LMS 集成**：从 Canvas LMS 获取并显示作业，实时更新

> [!CAUTION]
> 虽然我设置了权限检查，但访问系统文件等操作是危险的，请自行承担风险。

- **权限管理**：AI 分析任务执行是否需要修改任务文件夹之外的文件
- **批量操作**：选择多个任务进行批量操作（启用/禁用 AI 操作、删除）
- **拖放排序**：在"自定义排序"模式下手动重新排序任务
- **高级筛选**：按类别、状态、创建日期范围和截止日期范围筛选
- **灵活排序**：按创建日期、截止日期、优先级或自定义手动排序
- **搜索功能**：在任务标题和描述中进行全文搜索
- **文件夹集成**：点击任务文件夹路径在系统文件资源管理器中打开
- **终端集成**：点击"打开终端"直接在任务文件夹中启动本地终端窗口

> [!NOTE]
> 我尝试的内联渲染终端解决方案与本地 shell 相比功能不全。如果你有更好的解决方案，欢迎提交 PR。

- **用户配置文件**：可自定义的头像上传、名称编辑和位置检测
- **可配置的数据目录**：通过环境变量设置自定义存储位置

### 仪表板分析
- **任务统计**：总任务数、已完成、进行中、待办
- **完成率**：显示任务完成百分比的进度条
- **优先级分布**：按优先级级别细分
- **类别细分**：每个类别的任务及其进度条
- **AI 操作分布**：显示启用和禁用 AI 操作的任务的饼图

## 前置要求

- Python 3.7 或更高版本
- pip（Python 包管理器）
- iFlow CLI（用于 AI 驱动的任务执行）
- 现代网页浏览器（Chrome、Firefox、Safari、Edge）

## 安装

### 1. 克隆或下载仓库

```bash
cd Open2Do
```

### 2. 创建虚拟环境（推荐）

```bash
python3 -m venv venv
source venv/bin/activate  # Windows 上：venv\Scripts\activate
```

### 3. 安装依赖

```bash
pip install -r requirements.txt
```

这将安装：
- FastAPI 和 Uvicorn 用于 Web 服务器
- Jinja2 用于 HTML 模板
- Pydantic 用于数据验证
- python-dotenv 用于环境变量管理
- requests 用于 Canvas LMS API 集成

### 4. 配置环境变量（可选）

复制示例环境文件：

```bash
cp .env.example .env
```

编辑 `.env` 来配置：

- `DATA_DIR` - 存储任务数据的目录（默认：`./data`）
- `IFLOW_COMMAND` - 运行 iFlow 的命令（默认：`iflow`）
- `CANVAS_URL` - 您的 Canvas LMS 实例 URL（用于 Canvas 作业小部件）
- `ACCESS_TOKEN` - Canvas API 访问令牌（用于 Canvas 作业小部件）

## 启动应用

### 快速启动（使用提供的脚本）

```bash
./start.sh
```

### 手动启动

```bash
source venv/bin/activate  # Windows 上：venv\Scripts\activate
python -m uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

应用将启动并可在以下地址访问：**http://localhost:8000**

## 使用应用

### 截图

<div align="center">
  <h3>任务页面</h3>
  <img src="resources/Tasks.png" alt="任务页面截图" width="1000"/>
  
  <h3>仪表板</h3>
  <img src="resources/Dashboard.png" alt="仪表板截图" width="1000"/>
</div>

### 导航

通过网页浏览器访问应用：
- **任务页面**：http://localhost:8000/ - 主任务管理界面
- **仪表板**：http://localhost:8000/dashboard - 统计和分析

### 用户配置文件

1. 点击左侧边栏中的头像或"编辑配置文件"按钮
2. **上传头像**：点击相机按钮上传个人资料图片
3. **编辑名称**：更改显示名称
4. **设置位置**：
   - 点击"自动检测位置"使用浏览器地理定位
   - 或手动输入位置
5. **配置数据目录**：设置任务数据存储位置
6. 点击"保存更改"

### 创建任务

1. 点击快速操作栏中的"新建任务"按钮
2. 填写任务表单：
   - **标题**（必填）：任务名称
   - **类别**（必填）：任务类别（如工作、个人、购物）
   - **优先级**：低、中或高
   - **截止日期**：任务截止的日期和时间
   - **描述**：任务详细描述
3. 点击"添加任务"

每个任务将在 `data/task_folders/` 中创建一个新的独立文件夹。

### 管理任务

#### 基本操作
- **编辑任务**：点击铅笔图标修改任务详情
- **删除任务**：点击垃圾桶图标删除任务及其文件夹
- **更改状态**：编辑任务并将其状态更改为"进行中"或"已完成"

#### 选择任务
- **选择单个**：点击任何任务旁边的复选框
- **全选**：点击任务标题中的全选图标
- **批量操作栏**：选择任务时出现
  - **启用/禁用 AI 操作**：切换所选任务的 AI 执行按钮
  - **删除选中**：一次删除所有选中的任务

#### 使用 AI 执行任务
1. **启用 AI 操作**：选择任务并点击"启用/禁用 AI 操作"
2. **执行按钮**：启用的任务上会出现绿色播放按钮
3. **点击执行**：
   - 显示关于 AI 执行的警告
   - AI 检查任务是否需要修改文件夹之外的文件的权限
   - 如果需要权限：提示确认
   - 通过 iFlow CLI 执行任务
   - 状态自动设置为"已完成"

### 筛选和排序

#### 快速操作栏
- **新建任务**：展开任务创建表单
- **筛选任务**：展开筛选选项
- **排序方式**：展开排序选项

#### AI 自然语言自动填充
- **AI 输入框**：在任务页面顶部输入自然语言命令或使用语音输入
- **语音识别**：点击麦克风按钮说出命令 - 说话时实时转录
- **解析**：点击"解析"使用 iFlow CLI 分析您的输入
- **确认预览**：在应用之前查看检测到的表单更改
- **自动展开**：自动填充时表单自动展开
- **智能检测**：自动识别新建任务、筛选或排序操作
- **关键词提取**：提取关键词（2-5 个词）作为任务标题，使用完整句子作为描述

示例：
- "创建一个关于明天会议的高优先级工作任务"
- "显示工作类别的待办任务"
- "按截止日期排序任务"

> [!NOTE]
> 语音识别需要麦克风访问权限，在 Chrome 或 Edge 浏览器中效果最佳。

#### 筛选选项
- **类别**：按任务类别筛选
- **状态**：按任务状态筛选（待办、进行中、已完成）
- **优先级**：按优先级级别筛选（低、中、高）
- **搜索**：在标题和描述中全文搜索
- **创建日期范围**：按任务创建时间筛选
- **截止日期范围**：按截止日期筛选
- **清除筛选**：重置所有筛选

#### 排序选项
- **自定义排序**：拖放手动重新排序任务
- **创建日期**：按任务创建时间排序（升序/降序）
- **截止日期**：按截止日期排序（升序/降序）
- **优先级**：按优先级级别排序（低 → 中 → 高）

### 使用任务文件夹

每个任务都有自己的独立工作区：
- **文件夹路径**：显示在每个任务卡片上
- **点击打开**：点击文件夹路径在系统文件资源管理器中打开
- **打开终端**：点击"打开终端"直接在任务文件夹中启动本地终端窗口
  - 自动将相对路径转换为绝对路径
  - 支持 Windows、macOS 和 Linux
  - 支持常见终端模拟器（Terminal.app、cmd、gnome-terminal 等）
- **存储**：可以在此存储特定于任务的文件和笔记

### 仪表板分析

仪表板提供实时洞察：

#### 概览卡片
- **总任务**：任务总数
- **已完成**：标记为已完成的任务
- **进行中**：当前正在处理的任务
- **待办**：等待开始的任务

#### 可视化分析
- **完成率**：显示已完成任务百分比的进度条
- **优先级分布**：按优先级级别细分
- **AI 操作分布**：显示启用和禁用 AI 操作的任务的饼图
- **类别细分**：每个类别的任务及其进度条

仪表板每 10 秒自动刷新一次，以显示实时更新。

## 数据存储

所有数据存储在配置的 `DATA_DIR` 中（默认：`./data`）：

- `tasks.json` - 任务元数据，包括 AI 按钮状态和所有任务属性
- `task_folders/` - 单个任务工作区（每个任务一个文件夹）
- `avatars/` - 用户配置文件头像图像
- `user_profile.json` - 用户配置文件信息

您可以通过在 `.env` 中设置 `DATA_DIR` 环境变量来更改数据目录。

## iFlow 集成

### 前置要求
安装 iFlow CLI：
```bash
npm install -g iflow
```

### 工作原理
- **权限检查**：AI 分析任务描述以确定执行是否需要修改任务文件夹之外的文件
- **任务执行**：通过 iFlow CLI 传递适当的上下文执行任务
- **回退**：如果 iFlow 不可用，则模拟执行并显示成功消息

### 配置 iFlow
默认命令是 `iflow`。您可以在 `.env` 中自定义：
```
IFLOW_COMMAND=/path/to/iflow
```

## 停止应用

在运行应用的终端中按 `Ctrl+C`。

## 故障排除

### 端口已被占用
如果端口 8000 已被占用，请指定不同的端口：
```bash
python -m uvicorn app.main:app --reload --host 127.0.0.1 --port 8001
```

### 导入错误
确保在虚拟环境中：
```bash
source venv/bin/activate
```

### AI 执行不工作
- 验证 iFlow CLI 已安装且可访问
- 检查 `.env` 中的 iFlow 命令路径
- 检查浏览器控制台是否有错误消息

### 任务未显示
- 刷新页面
- 检查浏览器控制台是否有 JavaScript 错误
- 验证 `data/tasks.json` 存在且是有效的 JSON

### 仪表板未更新
- 仪表板每 10 秒自动刷新一次
- 手动点击"刷新仪表板"按钮强制更新

### Canvas 作业未加载
- 验证 Canvas URL 和访问令牌已在 `.env` 中配置
- 从 Canvas 获取访问令牌：账户 > 设置 > 已批准的集成
- 确保令牌具有适当的权限（读取课程内容）
- 检查浏览器控制台是否有错误消息

## Canvas LMS 集成

### 设置
要使用 Canvas 作业小部件：

1. 登录到您的 Canvas LMS 实例
2. 转到 **账户** > **设置** > **已批准的集成**
3. 点击 **+ 新访问令牌**
4. 输入用途（例如："Open2Do 作业"）
5. 复制生成的令牌
6. 添加到 `.env`：
   ```
   CANVAS_URL=https://your-canvas-instance.com
   ACCESS_TOKEN=your-access-token-here
   ```

### 使用 Canvas 作业
- Canvas 作业小部件显示在左侧边栏的个人资料下方
- 点击刷新按钮从所有活动课程获取所有作业
- 列表可滚动，具有最大高度以显示多个作业
- 作业按截止日期排序（没有截止日期的作业显示在最后）
- 逾期作业以红色背景高亮显示
- 每个作业显示：
  - 课程名称
  - 作业标题
  - 截止日期（本地格式）
  - 提交状态徽章（已提交、待办、逾期、无截止日期）
  - 可能的分数和当前得分（如果已评分）
- 已发布/未发布的作业指示器
- Toast 通知显示加载状态和结果

## 项目结构

```
Open2Do/
├── app/
│   ├── main.py              # FastAPI 应用和 API 端点（包括 Canvas LMS 集成）
│   ├── models.py            # Pydantic 数据模型
│   ├── storage.py           # JSON 存储处理器，支持用户配置文件
│   ├── ai_scheduler.py      # iFlow CLI 集成用于 AI 操作
│   ├── static/
│   │   ├── css/
│   │   │   └── styles.css   # 自定义深色主题样式
│   │   ├── js/
│   │   │   ├── app.js       # 主页面 JavaScript（包括 Canvas 作业小部件）
│   │   │   └── dashboard.js # 带有 Chart.js 的仪表板 JavaScript
│   │   └── o2dologo.png     # 应用图标
│   └── templates/
│       ├── index.html       # 带有可折叠部分的任务页面（包括 Canvas 小部件）
│       └── dashboard.html   # 统计仪表板
├── data/                    # 用户数据目录
│   ├── tasks.json           # 任务存储
│   ├── task_folders/        # 单个任务工作区
│   ├── avatars/             # 用户头像图像
│   └── user_profile.json   # 用户配置文件数据
├── requirements.txt         # Python 依赖
├── .env.example            # 环境配置模板
└── start.sh                # 启动脚本
```

## 键盘快捷键（提示）
- 使用 Tab 在表单字段之间导航
- 按 Enter 提交表单
- 使用箭头键导航下拉选项
- 按 Esc 关闭模态框

## 最佳实践
- **类别**：使用描述性的类别名称以更好地组织
- **优先级**：将"高"优先级保留给紧急任务
- **AI 操作**：仅对准备好自动执行的任务启用 AI 操作
- **备份**：定期备份 `data` 目录以防止数据丢失
- **任务文件夹**：在其指定文件夹中存储任务相关的文件和笔记

## 许可证

MIT。